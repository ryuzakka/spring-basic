<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybats-3-mapper.dtd">

<mapper namespace="kr.co.buck1.admin.AdminMapper">
	
	<select id="member" resultType="kr.co.buck1.member.MemberVO">
		select * 
		from member
		where
			userid like concat('%',#{param1},'%') or
			username like concat('%',#{param1},'%') or
			nickname like concat('%',#{param1},'%') or
			email like concat('%',#{param1},'%')
		limit #{param2},20
	</select>
	
	<select id="memberGetTotal" resultType="Integer">
		select ceil(count(*)/20)
		from member
		where
			userid like concat('%',#{param1},'%') or
			username like concat('%',#{param1},'%') or
			nickname like concat('%',#{param1},'%') or
			email like concat('%',#{param1},'%')
	</select>
	
	<select id="order" resultType="kr.co.buck1.vo.PurchaseVO">
		SELECT 
			a.*,
			b.name,
			b.size,
			c.storename,
			d.nickname
		FROM 
			purchase AS a,
			menu AS b,
			store AS c,
			member AS d
		WHERE 
			a.prod_code = b.code and
			a.store_id = c.id and
			a.userid = d.userid
		ORDER BY
			a.id DESC
	</select>
	
	<select id="getOrderCount" resultType="Integer">
		SELECT COUNT(DISTINCT order_code) AS cnt
		FROM purchase
	</select>
	
	<select id="getOrderItemCount" resultType="kr.co.buck1.vo.PurchaseVO">
		SELECT
			order_code,
			COUNT(*) AS cnt
		FROM
			purchase
		WHERE
			store_id != 'null'
		GROUP BY
			order_code
		ORDER BY
			id DESC
	</select>
	
</mapper>